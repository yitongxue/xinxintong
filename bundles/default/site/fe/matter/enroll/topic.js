!function(e){function t(i){if(n[i])return n[i].exports;var o=n[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var n={};t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,n,i){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:i})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=118)}({0:function(e,t){function n(e,t){var n=e[1]||"",o=e[3];if(!o)return n;if(t&&"function"==typeof btoa){var r=i(o);return[n].concat(o.sources.map(function(e){return"/*# sourceURL="+o.sourceRoot+e+" */"})).concat([r]).join("\n")}return[n].join("\n")}function i(e){return"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(e))))+" */"}e.exports=function(e){var t=[];return t.toString=function(){return this.map(function(t){var i=n(t,e);return t[2]?"@media "+t[2]+"{"+i+"}":i}).join("")},t.i=function(e,n){"string"==typeof e&&(e=[[null,e,""]]);for(var i={},o=0;o<this.length;o++){var r=this[o][0];"number"==typeof r&&(i[r]=!0)}for(o=0;o<e.length;o++){var a=e[o];"number"==typeof a[0]&&i[a[0]]||(n&&!a[2]?a[2]=n:n&&(a[2]="("+a[2]+") and ("+n+")"),t.push(a))}},t}},1:function(e,t,n){function i(e,t){for(var n=0;n<e.length;n++){var i=e[n],o=g[i.id];if(o){o.refs++;for(var r=0;r<o.parts.length;r++)o.parts[r](i.parts[r]);for(;r<i.parts.length;r++)o.parts.push(d(i.parts[r],t))}else{for(var a=[],r=0;r<i.parts.length;r++)a.push(d(i.parts[r],t));g[i.id]={id:i.id,refs:1,parts:a}}}}function o(e,t){for(var n=[],i={},o=0;o<e.length;o++){var r=e[o],a=t.base?r[0]+t.base:r[0],s=r[1],c=r[2],l=r[3],d={css:s,media:c,sourceMap:l};i[a]?i[a].parts.push(d):n.push(i[a]={id:a,parts:[d]})}return n}function r(e,t){var n=v(e.insertInto);if(!n)throw new Error("Couldn't find a style target. This probably means that the value for the 'insertInto' parameter is invalid.");var i=w[w.length-1];if("top"===e.insertAt)i?i.nextSibling?n.insertBefore(t,i.nextSibling):n.appendChild(t):n.insertBefore(t,n.firstChild),w.push(t);else if("bottom"===e.insertAt)n.appendChild(t);else{if("object"!=typeof e.insertAt||!e.insertAt.before)throw new Error("[Style Loader]\n\n Invalid value for parameter 'insertAt' ('options.insertAt') found.\n Must be 'top', 'bottom', or Object.\n (https://github.com/webpack-contrib/style-loader#insertat)\n");var o=v(e.insertInto+" "+e.insertAt.before);n.insertBefore(t,o)}}function a(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e);var t=w.indexOf(e);t>=0&&w.splice(t,1)}function s(e){var t=document.createElement("style");return e.attrs.type="text/css",l(t,e.attrs),r(e,t),t}function c(e){var t=document.createElement("link");return e.attrs.type="text/css",e.attrs.rel="stylesheet",l(t,e.attrs),r(e,t),t}function l(e,t){Object.keys(t).forEach(function(n){e.setAttribute(n,t[n])})}function d(e,t){var n,i,o,r;if(t.transform&&e.css){if(!(r=t.transform(e.css)))return function(){};e.css=r}if(t.singleton){var l=x++;n=b||(b=s(t)),i=u.bind(null,n,l,!1),o=u.bind(null,n,l,!0)}else e.sourceMap&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&"function"==typeof URL.revokeObjectURL&&"function"==typeof Blob&&"function"==typeof btoa?(n=c(t),i=f.bind(null,n,t),o=function(){a(n),n.href&&URL.revokeObjectURL(n.href)}):(n=s(t),i=p.bind(null,n),o=function(){a(n)});return i(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;i(e=t)}else o()}}function u(e,t,n,i){var o=n?"":i.css;if(e.styleSheet)e.styleSheet.cssText=k(t,o);else{var r=document.createTextNode(o),a=e.childNodes;a[t]&&e.removeChild(a[t]),a.length?e.insertBefore(r,a[t]):e.appendChild(r)}}function p(e,t){var n=t.css,i=t.media;if(i&&e.setAttribute("media",i),e.styleSheet)e.styleSheet.cssText=n;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(n))}}function f(e,t,n){var i=n.css,o=n.sourceMap,r=void 0===t.convertToAbsoluteUrls&&o;(t.convertToAbsoluteUrls||r)&&(i=y(i)),o&&(i+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(o))))+" */");var a=new Blob([i],{type:"text/css"}),s=e.href;e.href=URL.createObjectURL(a),s&&URL.revokeObjectURL(s)}var g={},m=function(e){var t;return function(){return void 0===t&&(t=e.apply(this,arguments)),t}}(function(){return window&&document&&document.all&&!window.atob}),h=function(e){return document.querySelector(e)},v=function(e){var t={};return function(e){if("function"==typeof e)return e();if(void 0===t[e]){var n=h.call(this,e);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}t[e]=n}return t[e]}}(),b=null,x=0,w=[],y=n(3);e.exports=function(e,t){if("undefined"!=typeof DEBUG&&DEBUG&&"object"!=typeof document)throw new Error("The style-loader cannot be used in a non-browser environment");t=t||{},t.attrs="object"==typeof t.attrs?t.attrs:{},t.singleton||"boolean"==typeof t.singleton||(t.singleton=m()),t.insertInto||(t.insertInto="head"),t.insertAt||(t.insertAt="bottom");var n=o(e,t);return i(n,t),function(e){for(var r=[],a=0;a<n.length;a++){var s=n[a],c=g[s.id];c.refs--,r.push(c)}if(e){i(o(e,t),t)}for(var a=0;a<r.length;a++){var c=r[a];if(0===c.refs){for(var l=0;l<c.parts.length;l++)c.parts[l]();delete g[c.id]}}}};var k=function(){var e=[];return function(t,n){return e[t]=n,e.filter(Boolean).join("\n")}}()},10:function(e,t,n){"use strict";function i(e,t){var n,i,o;n=document.createDocumentFragment(),i=document.createElement("div"),i.setAttribute("id","frmPlugin"),o=document.createElement("iframe"),i.appendChild(o),i.onclick=function(){i.parentNode.removeChild(i)},n.appendChild(i),document.body.appendChild(n),0===e.indexOf("http")?(window.onClosePlugin=function(){i.parentNode.removeChild(i),t&&t()},o.setAttribute("src",e)):o.contentDocument&&o.contentDocument.body&&(o.contentDocument.body.innerHTML=e)}angular.module("coinpay.ui.xxt",[]).service("tmsCoinPay",function(){this.showSwitch=function(e,t){var n;n=document.createElement("div"),n.classList.add("tms-switch","tms-switch-coinpay"),n.addEventListener("click",function(n){n.preventDefault(),n.stopPropagation();var o=location.protocol+"//"+location.host;o+="/rest/site/fe/coin/pay",o+="?site="+e,o+="&matter="+t,i(o)},!0),document.body.appendChild(n)}})},11:function(e,t,n){"use strict";function i(e,t){var n,i,o;n=document.createDocumentFragment(),i=document.createElement("div"),i.setAttribute("id","frmPlugin"),o=document.createElement("iframe"),i.appendChild(o),i.onclick=function(){i.parentNode.removeChild(i)},n.appendChild(i),document.body.appendChild(n),0===e.indexOf("http")?(window.onClosePlugin=function(){i.parentNode.removeChild(i),t&&t()},o.setAttribute("src",e)):o.contentDocument&&o.contentDocument.body&&(o.contentDocument.body.innerHTML=e)}angular.module("siteuser.ui.xxt",[]).service("tmsSiteUser",function(){this.showSwitch=function(e,t){var n;n=document.createElement("div"),n.classList.add("tms-switch","tms-switch-siteuser"),n.addEventListener("click",function(n){n.preventDefault(),n.stopPropagation();var o=location.protocol+"//"+location.host;o+="/rest/site/fe/user",o+="?site="+e,t?location.href=o:i(o)},!0),document.body.appendChild(n)}})},118:function(e,t,n){e.exports=n(60)},12:function(e,t,n){t=e.exports=n(0)(!1),t.push([e.i,"body,html{font-family:Microsoft Yahei,Arial;width:100%;height:auto}body{position:relative;font-size:16px;padding:0}.ng-cloak{display:none}.container{position:relative}.navbar-default .navbar-brand,.site-navbar-default .navbar-default .navbar-nav>li>a{color:#fff}.site-navbar-default .navbar-brand{padding:15px}.main-navbar .navbar-brand:hover{color:#fff}@media screen and (min-width:768px){.site-navbar-default .navbar-nav>li>a{padding:15px;line-height:1}}@media screen and (max-width:768px){.site-navbar-default .navbar-brand{width:100%;text-align:center}.site-navbar-default .navbar-brand>.icon-note{display:inline-block;width:124px;text-overflow:ellipsis;overflow:hidden;white-space:nowrap}.site-navbar-default .navbar-nav{margin:8px 0;position:absolute;top:0;right:0}.site-navbar-default .nav>li>a{padding:10px}}.tms-flex-row{display:flex;align-items:center}.tms-flex-row .tms-flex-grow{flex:1}.dropdown-menu{min-width:auto}.dropdown-menu-top{bottom:100%;top:auto}#picViewer{position:absolute;left:0;right:0;top:0;bottom:0;z-index:1051;display:none;margin:0 auto;overflow:hidden;background:#000}#picViewer>div{position:absolute;bottom:6px;left:8px;right:8px;z-index:1999;height:36px}#picViewer span{display:inline-block;width:36px;height:36px;line-height:25px;border-radius:18px;font-size:25px;text-align:center;color:#bbb}#picViewer span.page{position:absolute;left:50%;margin-left:-18px;font-size:18px}#picViewer span.prev{position:absolute;left:50%;margin-left:-72px}#picViewer span.next{position:absolute;left:50%;margin-left:36px}#picViewer span.exit{position:absolute;right:0}#picViewer span.exit>i{text-shadow:0 0 .1em #fff,0 0 .1em #fff}",""])},13:function(e,t,n){var i=n(12);"string"==typeof i&&(i=[[e.i,i,""]]);var o={hmr:!0};o.transform=void 0,o.insertInto=void 0;n(1)(i,o);i.locals&&(e.exports=i.locals)},14:function(e,t,n){"use strict";n(4),/MicroMessenger/i.test(navigator.userAgent)&&window.signPackage&&window.wx?window.wx.ready(function(){window.wx.showOptionMenu()}):/YiXin/i.test(navigator.userAgent)&&document.addEventListener("YixinJSBridgeReady",function(){YixinJSBridge.call("showOptionMenu")},!1),n(8),n(13),n(6),n(5),n(2),n(11),n(10),n(9);var i=["ngSanitize","ui.bootstrap","notice.ui.xxt","http.ui.xxt","page.ui.xxt","snsshare.ui.xxt","siteuser.ui.xxt","directive.enroll"];window.moduleAngularModules&&window.moduleAngularModules.forEach(function(e){i.push(e)});var o=angular.module("app",i);o.config(["$controllerProvider","$uibTooltipProvider","$locationProvider",function(e,t,n){o.provider={controller:e.register},t.setTriggers({show:"hide"}),n.html5Mode(!0)}]),o.controller("ctrlMain",["$scope","$q","http2","$timeout","tmsLocation","tmsDynaPage","tmsSnsShare","tmsSiteUser",function(e,t,n,i,r,a,s,c){function l(){var i,o;return o=t.defer(),i=r.j("entryRule","site","app"),n.get(i).then(function(t){e.params.entryRuleResult=t.data,o.resolve(t.data)})}function d(e,t){var n,i,o;n=document.body,i=document.createElement("div"),i.setAttribute("id","frmPlugin"),i.height=n.clientHeight,o=document.createElement("iframe"),i.appendChild(o),n.scrollTop=0,n.appendChild(i),window.onClosePlugin=function(){t?t().then(function(e){i.parentNode.removeChild(i)}):i.parentNode.removeChild(i)},i.onclick=function(){onClosePlugin()},e&&o.setAttribute("src",e),i.style.display="block"}function u(t){var n,i,o,r;r=!0,n=e,o=t.match(/\((.*?)\)/)[1].replace(/'|"/g,"").split(","),angular.forEach(t.replace(/\(.*?\)/,"").split("."),function(e){if(i&&(n=i),!n[e])return void(r=!1);i=n[e]}),r&&i.apply(n,o)}var p=[];e.closeWindow=function(){/MicroMessenger/i.test(navigator.userAgent)?window.wx.closeWindow():/YiXin/i.test(navigator.userAgent)&&window.YixinJSBridge.call("closeWebView")},e.askFollowSns=function(){var t;e.app.entryRule&&"Y"===e.app.entryRule.scope.sns&&(t=r.j("askFollow","site"),t+="&sns="+Object.keys(e.app.entryRule.sns).join(","),d(t,l))},e.askBecomeMember=function(){var t,n;e.app.entry_rule&&"Y"===e.app.entryRule.scope.member&&(n=Object.keys(e.app.entryRule.member),1===n.length?(t="/rest/site/fe/user/member?site="+e.app.siteid,t+="&schema="+n[0]):n.length>1&&(t="/rest/site/fe/user/memberschema?site="+e.app.siteid,t+="&schema="+n.join(",")),d(t,l))},e.addRecord=function(t,n){if(n)e.gotoPage(t,n,null,null,"Y");else for(var i in e.app.pages){var o=e.app.pages[i];if("I"===o.type){e.gotoPage(t,o.name,null,null,"Y");break}}},e.gotoApp=function(t){location.replace(e.app.entryUrl)},e.gotoPage=function(e,t,n,i,o){e&&(e.preventDefault(),e.stopPropagation());var a=r.j("","site","app");n?a+="&ek="+n:"cowork"===t&&(a+="&ek="+r.s().ek),i&&(a+="&rid="+i),t&&(a+="&page="+t),o&&"Y"===o&&(a+="&newRecord=Y"),location=a},e.openMatter=function(e,t,n,i){var o="/rest/site/fe/matter?site="+r.s().site+"&id="+e+"&type="+t;n?location.replace(o):!1===i?location.href=o:window.open(o)},e.onReady=function(t){e.params?u(t):p.push(t)},e.setSnsShare=function(t,i){function o(){if("miniprogram"!==window.__wxjs_environment){var o,a,c,l,d,u;o=e.app,a=e.page,c=e.user,l=location.protocol+"//"+location.host+r.j("","site","app","rid"),a&&a.share_page&&"Y"===a.share_page?l+="&page="+a.name:r.s().page&&(l+="&page="+r.s().page),t&&t.enroll_key&&(l+="&ek="+t.enroll_key),i&&angular.forEach(i,function(e,t){void 0!==e&&(l+="&"+t+"="+e)}),d=c.uid+"_"+1*new Date,l+="&shareby="+d,u=o.summary,a&&a.share_summary&&a.share_summary.length&&t&&(u=t.data[a.share_summary]),window.shareCounter=0,s.config({siteId:o.siteid,logger:function(e){var t;t="/rest/site/fe/matter/logShare",t+="?shareid="+d,t+="&site="+o.siteid,t+="&id="+o.id,t+="&type=enroll",t+="&title="+o.title,t+="&shareby="+d,t+="&shareto="+e,n.get(t),window.shareCounter++,window.onshare&&window.onshare(window.shareCounter)},jsApiList:["hideOptionMenu","onMenuShareTimeline","onMenuShareAppMessage","chooseImage","uploadImage","getLocation","startRecord","stopRecord","onVoiceRecordEnd","playVoice","pauseVoice","stopVoice","onVoicePlayEnd","uploadVoice","downloadVoice"]}),s.set(o.title,l,u,o.pic)}}/MicroMessenger|Yixin/i.test(navigator.userAgent)&&(window.WeixinJSBridge&&WeixinJSBridge.invoke?o():document.addEventListener("WeixinJSBridgeReady",o,!1))},e.isSmallLayout=!1,window.screen&&window.screen.width<992&&(e.isSmallLayout=!0),n.get(r.j("get","site","app","rid","page","ek","newRecord")).then(function(t){var r=t.data,s=r.site,c=r.app,l=r.mission,d=(r.page,r.user),f={},g="";c.dataSchemas.forEach(function(e){f[e.id]=e}),c._schemasById=f,e.params=r,e.site=s,e.mission=l,e.app=c,e.user=d,"Y"===c.multi_rounds&&r.activeRound&&(e.activeRound=r.activeRound,g=r.activeRound.rid),"Y"===c.use_site_header&&s&&s.header_page&&a.loadCode(o,s.header_page),"Y"===c.use_mission_header&&l&&l.header_page&&a.loadCode(o,l.header_page),"Y"===c.use_mission_footer&&l&&l.footer_page&&a.loadCode(o,l.footer_page),"Y"===c.use_site_footer&&s&&s.footer_page&&a.loadCode(o,s.footer_page),r.page&&a.loadCode(o,r.page).then(function(){e.page=r.page}),"Y"===c.can_siteuser&&(e.siteUser=function(e){var t=location.protocol+"//"+location.host;t+="/rest/site/fe/user",t+="?site="+e,location.href=t}),p.length&&angular.forEach(p,u);var m;(m=document.querySelector(".loading"))&&m.parentNode.removeChild(m),i(function(){e.$broadcast("xxt.app.enroll.ready",r)}),n.post("/rest/site/fe/matter/logAccess?site="+c.siteid+"&id="+c.id+"&type=enroll&title="+c.title,{search:location.search.replace("?",""),referer:document.referrer,rid:g,assignedNickname:d.nickname})})}]),e.exports=o},15:function(e,t,n){"use strict";var i={};i.isEmpty=function(e,t){if(void 0===t)return!0;switch(e.type){case"multiple":for(var n in t)if(!0===t[n])return!1;return!0;default:return 0===t.length}},i.checkRequire=function(e,t){return void 0!==t&&!this.isEmpty(e,t)||"请填写必填题目［"+e.title+"］"},i.checkFormat=function(e,t){if("number"===e.format){if(!/^-{0,1}[0-9]+(.[0-9]+){0,1}$/.test(t))return"题目［"+e.title+"］请输入数值"}else if("name"===e.format){if(/^-{0,1}[0-9]+(.[0-9]+){0,1}$/.test(t))return"题目［"+e.title+"］请输入字母或者汉字，并不少于2个字符";if(t.length<2)return"题目［"+e.title+"］请输入正确的姓名（不少于2个字符）"}else if("mobile"===e.format){if(!/^1(3[0-9]|4[57]|5[0-35-9]|7[0135678]|8[0-9])\d{8}$/.test(t))return"题目［"+e.title+"］请输入正确的手机号（11位数字）"}else if("email"===e.format&&!/^[A-Za-z\d]+([-_.][A-Za-z\d]+)*@([A-Za-z\d]+[-.])+[A-Za-z\d]{2,4}$/.test(t))return"题目［"+e.title+"］请输入正确的邮箱";return!0},i.checkCount=function(e,t){return!(0!=e.count&&void 0!==e.count&&t.length>e.count)||"［"+e.title+"］超出上传数量（"+e.count+"）限制"},i.checkValue=function(e,t){var n;if(e.required&&"Y"===e.required&&!0!==(n=this.checkRequire(e,t)))return n;if(t){if("shorttext"===e.type&&e.format&&!0!==(n=this.checkFormat(e,t)))return n;if("multiple"===e.type&&"Y"===e.limitChoice&&e.range){var i=0;for(var o in t)t[o]&&i++;if(i<e.range[0]||i>e.range[1])return"【"+e.title+"】中最多只能选择("+e.range[1]+")项，最少需要选择("+e.range[0]+")项"}if(/image|file/.test(e.type)&&e.count&&!0!==(n=this.checkCount(e,t)))return n}return!0},i.loadRecord=function(e,t,n){if(!n)return!1;var o,r,a;for(o in n)if("member"===o)t.member=angular.extend(t.member,n.member);else if(r=e[o])if(/score|url/.test(r.type))t[o]=n[o],"url"===r.type&&(t[o]._text=i.urlSubstitute(t[o]));else if(n[o].length)if("image"===r.type){a=n[o].split(","),t[o]=[];for(var s in a)t[o].push({imgSrc:a[s]})}else if("multiple"===r.type){a=n[o].split(","),t[o]={};for(var s in a)t[o][a[s]]=!0}else t[o]=n[o];return!0},i.autoFillDefault=function(e,t){angular.forEach(e,function(e){e.defaultValue&&void 0===t[e.id]&&(t[e.id]=e.defaultValue)})},i.autoFillMember=function(e,t,n){t.members&&angular.forEach(e,function(e){if(e.schema_id&&t.members[e.schema_id]){var i,o,r;if(i=t.members[e.schema_id],o=e.id.split("."),2===o.length)n[o[1]]=i[o[1]];else if(3===o.length&&i.extattr)switch(n.extattr||(n.extattr={}),e.type){case"multiple":if(r=i.extattr[o[2]],angular.isObject(r)){n.extattr[o[2]]={};for(var a in r)r[a]&&(n.extattr[o[2]][a]=!0)}break;default:n.extattr[o[2]]=i.extattr[o[2]]}}})},i.txtSubstitute=function(e){return e.replace(/\n/g,"<br>")},i.urlSubstitute=function(e){var t;return t="",e&&(e.title&&(t+="【"+e.title+"】"),e.description&&(t+=e.description)),t+='<a href="'+e.url+'">网页链接</a>'},i.optionsSubstitute=function(e,t){var n,i,o=[];return(n=t)?e.ops&&e.ops.length&&(i=n.split(","),e.ops.forEach(function(e){-1!==i.indexOf(e.v)&&o.push(e.l)}),n=o.join(",")):n="",n},e.exports=i},2:function(module,exports,__webpack_require__){"use strict";var ngMod=angular.module("page.ui.xxt",[]);ngMod.directive("dynamicHtml",["$compile",function(e){return{restrict:"EA",replace:!0,link:function(t,n,i){t.$watch(i.dynamicHtml,function(i){i&&i.length&&(n.html(i),e(n.contents())(t))})}}}]),ngMod.service("tmsDynaPage",["$q",function($q){this.loadCss=function(e){var t,n;t=document.createElement("style"),t.innerHTML=e,n=document.querySelector("head"),n.appendChild(t)},this.loadExtCss=function(e){var t,n;t=document.createElement("link"),t.href=e,t.rel="stylesheet",n=document.querySelector("head"),n.appendChild(t)},this.loadJs=function(ngApp,js){!function(ngApp){eval(js)}(ngApp)},this.loadScript=function(e){var t,n,i=$q.defer();return n=function(){var o;o=document.createElement("script"),o.src=e[t],o.onload=function(){t++,t<e.length?n():i.resolve()},document.body.appendChild(o)},e&&(angular.isString(e)&&(e=[e]),e.length&&(t=0,n())),i.promise},this.loadExtJs=function(e,t){var n,i=this,o=$q.defer(),r=t.ext_js.length;return n=function(n){var a;a=document.createElement("script"),a.src=n.url,a.onload=function(){0===--r&&(t.js&&t.js.length&&i.loadJs(e,t.js),o.resolve())},document.body.appendChild(a)},t.ext_js&&t.ext_js.length&&t.ext_js.forEach(n),o.promise},this.loadCode=function(e,t){var n=this,i=$q.defer();return t.ext_css&&t.ext_css.length&&t.ext_css.forEach(function(e){n.loadExtCss(e.url)}),t.css&&t.css.length&&this.loadCss(t.css),t.ext_js&&t.ext_js.length?n.loadExtJs(e,t).then(function(){i.resolve()}):(t.js&&t.js.length&&n.loadJs(e,t.js),i.resolve()),i.promise},this.openPlugin=function(e){var t,n,i,o,r=$q.defer();return document.documentElement.clientWidth>768?document.documentElement.scrollTop=0:document.body.scrollTop=0,o=document.getElementsByTagName("body")[0],o.style.cssText="overflow-y:hidden",t=document.createDocumentFragment(),n=document.createElement("div"),n.setAttribute("id","frmPlugin"),i=document.createElement("iframe"),n.appendChild(i),n.onclick=function(){n.parentNode.removeChild(n),o.style.cssText="overflow-y:auto"},t.appendChild(n),document.body.appendChild(t),0===e.indexOf("http")?(window.onClosePlugin=function(e){n.parentNode.removeChild(n),o.style.cssText="overflow-y:auto",r.resolve(e)},i.setAttribute("src",e)):i.contentDocument&&i.contentDocument.body&&(i.contentDocument.body.innerHTML=e),r.promise}}])},22:function(e,t){e.exports='<div class="modal-body">\n    <div class=\'form-group\'>\n        <div class=\'input-group\'>\n            <input type=\'text\' class=\'form-control\' ng-model="newTag.label">\n            <div class=\'input-group-btn\'>\n                <button class=\'btn btn-default\' ng-click="addTag()" ng-disabled="!newTag.label">创建标签</button>\n            </div>\n        </div>\n    </div>\n    <div class=\'list-group\'>\n        <div class=\'list-group-item\' ng-repeat="tag in tags">\n            <label class=\'checkbox-inline\'>\n                <input type=\'checkbox\' ng-model="tag.checked" ng-change="checkTag(tag)"> <span ng-bind="tag.label"></span></label>\n        </div>\n    </div>\n</div>\n<div class="modal-footer">\n    <div class=\'text-center\'>\n        <button class="btn btn-default" ng-click="cancel()">取消</button>\n        <button class="btn btn-primary" ng-click="ok()">保存</button>\n    </div>\n</div>'},23:function(e,t){e.exports='<div class="modal-body">\n    <div class=\'panel panel-default\' ng-repeat="topic in topics">\n        <div class=\'panel-body\'>\n            <div class=\'checkbox\'>\n                <label>\n                    <input type=\'checkbox\' ng-model="topic.checked" ng-change="checkTopic(topic)"> <span ng-bind="topic.title"></span></label>\n            </div>\n            <div class=\'form-group\'>\n                <div class=\'small text-muted\' ng-bind="topic.summary"></div>\n            </div>\n            <div class=\'bottom-bar small text-muted\'>\n                <div ng-bind="topic.create_at*1000|date:\'yy-MM-dd\'"></div>\n                <div><i class=\'glyphicon glyphicon-file\'></i> <span ng-bind="topic.rec_num"></span></div>\n            </div>\n        </div>\n    </div>\n</div>\n<div class="modal-footer">\n    <div class=\'text-center\'>\n        <button class="btn btn-default" ng-click="cancel()">取消</button>\n        <button class="btn btn-primary" ng-click="ok()">确定</button>\n    </div>\n</div>'},24:function(e,t){e.exports='<div ng-if="rec">\n    <div ng-repeat="schema in schemas">\n        <div class=\'schema\' ng-class="{\'cowork\':schema.cowork===\'Y\'}" ng-if="rec.data[schema.id]||schema.cowork===\'Y\'" ng-switch on="schema.type">\n            <div class=\'text-muted data-title\'>{{schema.title}}</div>\n            <div ng-switch-when="file">\n                <div ng-repeat="file in rec.data[schema.id]">\n                    <video ng-if="file.type.indexOf(\'video\')===0" controls="controls" preload="none">\n                        <source src="{{file.url}}" type="{{file.type}}" />\n                    </video>\n                    <audio ng-if="file.type.indexOf(\'audio\')===0" controls="controls" preload="none">\n                        <source src="{{file.url}}" type="{{file.type}}" />\n                    </audio>\n                    <img ng-if="file.type.indexOf(\'image\')===0" ng-src=\'{{file.url}}\' style="width:40%" />\n                </div>\n            </div>\n            <div ng-switch-when="voice">\n                <div ng-repeat="voice in rec.data[schema.id]">\n                    <audio controls="controls" preload="none">\n                        <source src="{{voice.url}}" type="{{voice.type}}" />\n                    </audio>\n                </div>\n            </div>\n            <div ng-switch-when="image">\n                <ul class=\'list-unstyled\'>\n                    <li ng-repeat="img in rec.data[schema.id].split(\',\')"><img ng-src="{{img}}" /></li>\n                </ul>\n            </div>\n            <div ng-switch-when="multitext">\n                <ul ng-if="rec.data[schema.id]" style=\'padding-left:20px\'>\n                    <li ng-repeat="item in rec.data[schema.id]"><span dynamic-html="item.value"></span></li>\n                </ul>\n            </div>\n            <div ng-switch-when="single"><span ng-bind="rec.data[schema.id]"></span></div>\n            <div ng-switch-when="multiple"><span ng-bind="rec.data[schema.id]"></span></div>\n            <div ng-switch-when="longtext">\n                <span ng-bind-html="rec.data[schema.id]"></span>\n            </div>\n            <div ng-switch-when="url">\n                <span ng-bind-html="rec.data[schema.id]._text"></span>\n            </div>\n            <div ng-switch-default>\n                <span ng-bind="rec.data[schema.id]"></span>\n            </div>\n            <div ng-if="schema.cowork===\'Y\'">\n                <button class=\'btn btn-default btn-sm\' ng-click="coworkRecord(rec)"><span ng-if="rec.coworkState[schema.id].length">查看全部（<span ng-bind="rec.coworkState[schema.id].length"></span>）或</span>添加 <span class=\'glyphicon glyphicon-menu-right\'></span> <span class=\'text-muted\' ng-if="rec._coworkRequireLikeNum">（还需要{{rec._coworkRequireLikeNum}}个<span class=\'glyphicon glyphicon-thumbs-up\'></span>）</span>\n                </button>\n            </div>\n            <div ng-if="schema.supplement===\'Y\'&&rec.supplement[schema.id]" class=\'supplement\' ng-bind-html="rec.supplement[schema.id]"></div>\n        </div>\n    </div>\n</div>'},25:function(e,t,n){"use strict";var i=angular.module("repos.ui.enroll",[]),o=n(15);i.directive("tmsReposRecordData",["$templateCache",function(e){return{restrict:"A",template:n(24),scope:{schemas:"=",rec:"=record"},controller:["$scope","$sce","tmsLocation",function(e,t,n){e.coworkRecord=function(e){var t;t=n.j("","site","app"),t+="&ek="+e.enroll_key,t+="&page=cowork",t+="#cowork",location.href=t},e.$watch("rec",function(n){n&&e.$watch("schemas",function(i){if(i){var r,a;for(var s in e.schemas)if(r=e.schemas[s],a=n.data[r.id])switch(r.type){case"longtext":n.data[r.id]=o.txtSubstitute(a);break;case"url":a._text=o.urlSubstitute(a);break;case"file":case"voice":a.forEach(function(e){e.url&&(e.url=t.trustAsResourceUrl(e.url))});break;case"single":case"multiple":n.data[r.id]=t.trustAsHtml(o.optionsSubstitute(r,a))}}})})}]}}])},26:function(e,t,n){"use strict";angular.module("tag.ui.enroll",[]).factory("enlTag",["$q","$uibModal","http2","tmsLocation",function(e,t,i,o){var r={};return r.assignTag=function(r){var a;return a=e.defer(),t.open({template:n(22),controller:["$scope","$uibModalInstance",function(e,t){var n;n=[],e.newTag={},e.checkTag=function(e){e.checked?n.push(e.tag_id):n.splice(n.indexOf(e.tag_id),1)},e.addTag=function(){i.post(o.j("tag/submit","site","app"),e.newTag).then(function(t){var n;e.newTag={},n=t.data,e.tags.splice(0,0,t.data),n.checked=!0,e.checkTag(n)})},e.cancel=function(){t.dismiss()},e.ok=function(){t.close(n)},i.get(o.j("tag/byRecord","site")+"&record="+r.id).then(function(t){t.data.user.forEach(function(e){n.push(e.tag_id)}),i.get(o.j("tag/list","site","app")+"&public=Y").then(function(t){t.data.forEach(function(e){e.checked=-1!==n.indexOf(e.tag_id)}),e.tags=t.data})})}],backdrop:"static",windowClass:"modal-opt-topic auto-height"}).result.then(function(e){i.post(o.j("tag/assign","site"),{record:r.id,tag:e}).then(function(e){a.resolve(e)})}),a.promise},r}])},27:function(e,t,n){"use strict";angular.module("topic.ui.enroll",[]).factory("enlTopic",["$q","$uibModal","http2","tmsLocation",function(e,t,i,o){var r={};return r.assignTopic=function(r,a){var s;return s=e.defer(),t.open({template:n(23),controller:["$scope","$uibModalInstance",function(t,n){var s;s=[],t.checkTopic=function(e){e.checked?s.push(e.id):s.splice(s.indexOf(e.id),1)},t.cancel=function(){n.dismiss()},t.ok=function(){n.close(s)},i.get(o.j("topic/byRecord","site")+"&record="+r.id).then(function(n){n.data.forEach(function(e){s.push(e.topic_id)});var r=e.defer();r.promise.then(function(e){e.forEach(function(e){e.checked=-1!==s.indexOf(e.id)}),t.topics=e}),a?r.resolve(a):i.get(o.j("topic/list","site","app")).then(function(e){r.resolve(e.data.topics)})})}],backdrop:"static",windowClass:"modal-opt-topic auto-height"}).result.then(function(e){i.post(o.j("topic/assign","site")+"&record="+r.id,{topic:e}).then(function(e){s.resolve(e)})}),s.promise},r}])},3:function(e,t){e.exports=function(e){var t="undefined"!=typeof window&&window.location;if(!t)throw new Error("fixUrls requires window.location");if(!e||"string"!=typeof e)return e;var n=t.protocol+"//"+t.host,i=n+t.pathname.replace(/\/[^\/]*$/,"/");return e.replace(/url\s*\(((?:[^)(]|\((?:[^)(]+|\([^)(]*\))*\))*)\)/gi,function(e,t){var o=t.trim().replace(/^"(.*)"$/,function(e,t){return t}).replace(/^'(.*)'$/,function(e,t){return t});if(/^(#|data:|http:\/\/|https:\/\/|file:\/\/\/|\s*$)/i.test(o))return e;var r;return r=0===o.indexOf("//")?o:0===o.indexOf("/")?n+o:i+o.replace(/^\.\//,""),"url("+JSON.stringify(r)+")"})}},4:function(module,exports,__webpack_require__){"use strict";var ngMod=angular.module("snsshare.ui.xxt",[]);ngMod.service("tmsSnsShare",["$http",function($http){function setWxShare(e,t,n,i,o){window.wx.onMenuShareTimeline({title:o.descAsTitle?n:e,link:t,imgUrl:i,success:function(){try{o.logger&&o.logger("T")}catch(e){alert("share failed:"+e.message)}},cancel:function(){},fail:function(){alert("shareT: fail")}}),window.wx.onMenuShareAppMessage({title:e,desc:n,link:t,imgUrl:i,success:function(){try{o.logger&&o.logger("F")}catch(e){alert("share failed:"+e.message)}},cancel:function(){},fail:function(){alert("shareF: fail")}})}function setYxShare(e,t,n,i,o){var r={img_url:i,link:t,title:e,desc:n};window.YixinJSBridge.on("menu:share:appmessage",function(e){try{o.logger&&o.logger("F")}catch(e){alert("share failed:"+e.message)}window.YixinJSBridge.invoke("sendAppMessage",r,function(e){})}),window.YixinJSBridge.on("menu:share:timeline",function(e){try{o.logger&&o.logger("T")}catch(e){alert("share failed:"+e.message)}window.YixinJSBridge.invoke("shareTimeline",r,function(e){})})}var _isReady=!1;this.config=function(e){this.options=e},this.set=function(title,link,desc,img,fnOther){var _this=this;if(img&&-1===img.indexOf(location.protocol)&&(img=location.protocol+"//"+location.host+img),_isReady)/MicroMessenger/i.test(navigator.userAgent)?setWxShare(title,link,desc,img,_this.options):/Yixin/i.test(navigator.userAgent)?setYxShare(title,link,desc,img,_this.options):fnOther&&"function"==typeof fnOther&&fnOther(title,link,desc,img);else if(/MicroMessenger/i.test(navigator.userAgent)){var script;script=document.createElement("script"),script.src=location.protocol+"//res.wx.qq.com/open/js/jweixin-1.0.0.js",script.onload=function(){var xhr,url;xhr=new XMLHttpRequest,url="/rest/site/fe/wxjssdksignpackage?site="+_this.options.siteId+"&url="+encodeURIComponent(location.href.split("#")[0]),xhr.open("GET",url,!0),xhr.onreadystatechange=function(){if(4==xhr.readyState)if(xhr.status>=200&&xhr.status<400){var signPackage;try{eval("("+xhr.responseText+")"),signPackage&&(signPackage.debug=!1,signPackage.jsApiList=_this.options.jsApiList,wx.config(signPackage),wx.ready(function(){setWxShare(title,link,desc,img,_this.options),_isReady=!0}),wx.error(function(e){alert(JSON.stringify(e))}))}catch(e){alert("local error:"+e.toString())}}else alert("http error:"+xhr.statusText)},xhr.send()},document.body.appendChild(script)}else/Yixin/i.test(navigator.userAgent)?void 0===window.YixinJSBridge?document.addEventListener("YixinJSBridgeReady",function(){setYxShare(title,link,desc,img,_this.options),_isReady=!0},!1):(setYxShare(title,link,desc,img,_this.options),_isReady=!0):fnOther&&"function"==typeof fnOther&&(fnOther(title,link,desc,img),_isReady=!0)}}])},41:function(e,t,n){t=e.exports=n(0)(!1),t.push([e.i,'body{margin-bottom:64px}blockquote{font-size:16px;margin-bottom:8px}img{max-width:100%}.navbar-header .page-title{display:inline-block}.navbar-header .page-title .notice-count{display:inline-block;background:red;color:#fff;line-height:14px;min-width:14px;border-radius:7px;font-size:8px;vertical-align:middle;margin-left:4px}.navbar-header .page-title .caret{margin-left:4px}.tms-nav-target .btn .notice-count{background:red;color:#fff;line-height:14px;min-width:14px;border-radius:7px;font-size:8px;vertical-align:middle;margin-left:4px}.bottom-bar{display:flex;font-size:.9em;color:#777}.bottom-bar>*+*{margin-left:16px}.bottom-bar>*+* .like{color:#e5b526}.bottom-bar>:first-child{flex:1}.bottom-bar a{text-decoration:none;color:#777}.bottom-bar .dropdown button{border:0}#advCriteria .panel-group{margin-bottom:8px}#advCriteria .form-control{float:none}#advCriteria .form-group{display:block}#advCriteria .form-group:last-child{margin-bottom:0}#advCriteria .dir-level-2,#advCriteria .dir-level-3{margin-left:1em}#advCriteria .dir.active{background-color:#ddd}#filterQuick{margin:4px 8px;padding:4px 0;overflow-x:auto;overflow-y:hidden;white-space:nowrap}#filterQuick>*{display:inline-block}#filterTip{margin:4px 8px;padding:4px 0}#filterTip>*{display:inline-block;padding:4px 8px}#filterTip>*+*,#filterTip>* .close{margin-left:4px}#repos .record{background:#fff;border-bottom:1px solid #ddd;padding:8px 16px}#repos .record>*{margin:8px 0}#repos .record .header{display:flex}#repos .record .header .seq{margin-right:8px}#repos .record .header .label{padding-top:.3em}#repos .record .header .nickname{flex-grow:1;text-align:left;font-size:.9em}#repos .record .header>*+*{padding-left:8px}#repos .record .data blockquote .schema>div+div,#repos .record .data blockquote>div+div{margin-top:8px}#repos .record .data .data-title:before{content:" ";display:inline-block;width:12px;height:12px;border-top:6px solid #fff;border-right:6px solid #fff;border-bottom:6px solid #fff;border-left:6px solid #e5b526}#repos .record .data .datetime{font-size:.8em}#repos .record .tags>button+button{margin-left:4px}#repos .record .remarks{font-size:.9em;border-top:1px dashed #ddd;margin-top:16px;padding:1rem 0 0 2rem;position:relative}#repos .record .remarks:before{content:"\\63A8\\8350\\7559\\8A00";position:absolute;left:50%;margin-left:-2em;top:-.7em;color:#999}#repos .record .remarks .remark .top-bar{display:flex}#repos .record .remarks .remark .top-bar>:first-child{flex:1}#repos .record .remarks .remark+.remark{margin-bottom:1em}#repos .tag{background:#3af;padding:4px 6px;margin:4px;border-radius:2px;font-size:.8em;color:#fff}#favorGuide{position:fixed;align-items:center;z-index:1051;width:100%;bottom:0;display:flex;border:1px solid #bce8f1;background:#d9edf7;padding:8px 16px;color:#31708f}#favorGuide>:first-child{flex-grow:1}#favorGuide>:last-child{margin-left:4px}@media screen and (max-width:768px){.site-navbar-default{margin-bottom:0}.app .records.col-xs-12{padding:0}#filterCriteria{margin-left:-1px;margin-right:-1px}#filterCriteria .form-control,#filterCriteria .input-group-btn .btn{border-radius:0}#advCriteria{position:absolute;top:34px;right:0;margin-top:1px;width:300px;background:#fff;padding:0 0 8px;border:1px solid #ccc;border-top:0;z-index:1000}#advCriteria .panel-group .panel{margin:0 -1px;border-radius:0}}',""])},44:function(e,t,n){var i=n(41);"string"==typeof i&&(i=[[e.i,i,""]]);var o={hmr:!0};o.transform=void 0,o.insertInto=void 0;n(1)(i,o);i.locals&&(e.exports=i.locals)},5:function(e,t,n){"use strict";var i=angular.module("http.ui.xxt",[]);i.provider("tmsLocation",function(){var e;this.config=function(t){e=t||location.pathname},this.$get=["$location",function(t){return e||(e=location.pathname),{s:function(){return t.search()},j:function(n){var i=e,o=[];n&&n.length&&(i+="/"+n);for(var r=1,a=arguments.length;r<a;r++)o.push(arguments[r]+"="+(t.search()[arguments[r]]||""));return o.length&&(i+="?"+o.join("&")),i}}}]}),i.service("http2",["$rootScope","$http","$timeout","$q","$sce","$compile",function(e,t,n,i,o,r){function a(t,n,i){var a;return o.trustAsHtml(t),a=angular.element("<div></div>"),a.attr({class:"tms-notice alert alert-"+(n||"info"),"ng-style":"{'z-index':1099}"}).html(t),i||a[0].addEventListener("click",function(){document.body.removeChild(a[0])},!0),r(a)(e),document.body.appendChild(a[0]),a[0]}function s(e){e&&document.body.removeChild(e)}this.get=function(e,o){var r,c,l=i.defer();return o=angular.extend({headers:{accept:"application/json"},parseResponse:!0,autoBreak:!0,autoNotice:!0,showProgress:!0,showProgressDelay:500,showProgressText:"正在获取数据..."},o),!0===o.showProgress&&(c=n(function(){c=null,r=a(o.showProgressText,"info")},o.showProgressDelay)),t.get(e,o).success(function(e){if(!0===o.showProgress&&(c&&n.cancel(c),r&&(s(r),r=null)),o.parseResponse)if(angular.isString(e)){if(o.autoNotice&&a(e,"warning"),o.autoBreak)return;l.reject(e)}else if(0!=e.err_code){if(o.autoNotice){var t;t=angular.isString(e.err_msg)?e.err_msg:angular.isArray(e.err_msg)?e.err_msg.join("<br>"):JSON.stringify(e.err_msg),a(t,"warning")}if(o.autoBreak)return;l.reject(e)}else l.resolve(e);else l.resolve(e)}).error(function(e,t){!0===o.showProgress&&(c&&n.cancel(c),r&&(s(r),r=null)),a(null===e?"网络不可用":e,"danger")}),l.promise},this.post=function(e,o,r){var c,l,d=i.defer();return r=angular.extend({headers:{accept:"application/json"},parseResponse:!0,autoBreak:!0,autoNotice:!0,showProgress:!0,showProgressDelay:500,showProgressText:"正在获取数据..."},r),!0===r.showProgress&&(l=n(function(){l=null,c=a(r.showProgressText,"info")},r.showProgressDelay)),t.post(e,o,r).success(function(e){if(!0===r.showProgress&&(l&&n.cancel(l),c&&(s(c),c=null)),r.parseResponse)if(angular.isString(e)){if(r.autoNotice&&(a(e,"warning"),c=null),r.autoBreak)return;d.reject(e)}else if(0!=e.err_code){if(r.autoNotice){var t;t=angular.isString(e.err_msg)?e.err_msg:angular.isArray(e.err_msg)?e.err_msg.join("<br>"):JSON.stringify(e.err_msg),a(t,"warning")}if(r.autoBreak)return;d.reject(e)}else d.resolve(e);else d.resolve(e)}).error(function(e,t){!0===r.showProgress&&(l&&n.cancel(l),c&&(s(c),c=null)),a(null===e?"网络不可用":e,"danger")}),d.promise}}])},6:function(e,t,n){"use strict";angular.module("notice.ui.xxt",["ngSanitize"]).service("noticebox",["$timeout","$q",function(e,t){var n="tmsbox"+1*new Date,i={type:"",timer:null},o=function(e,t){var o;return o=document.querySelector("#"+n),null===o?(o=document.createElement("div"),o.setAttribute("id",n),o.classList.add("notice-box"),o.classList.add("alert"),o.classList.add("alert-"+e),o.innerHTML="<div>"+t+"</div>",document.body.appendChild(o),i.type=e):(i.type!==e&&(o.classList.remove("alert-"+e),i.type=e),o.childNodes[0].innerHTML=t),o};this.close=function(){var e;(e=document.querySelector("#"+n))&&document.body.removeChild(e)},this.error=function(t){var n,r;i.timer&&(e.cancel(i.timer),i.timer=null),n=o("danger",t),r=document.createElement("button"),r.classList.add("close"),r.innerHTML="<span>&times;</span>",n.insertBefore(r,n.childNodes[0]),r.addEventListener("click",function(){document.body.removeChild(n)})},this.warn=function(t){var n,r;i.timer&&(e.cancel(i.timer),i.timer=null),n=o("warning",t),r=document.createElement("button"),r.classList.add("close"),r.innerHTML="<span>&times;</span>",n.insertBefore(r,n.childNodes[0]),r.addEventListener("click",function(){document.body.removeChild(n)})},this.success=function(t){var n;i.timer&&e.cancel(i.timer),n=o("success",t),i.timer=e(function(){n.parentNode&&n.parentNode===document.body&&document.body.removeChild(n),i.timer=null},2e3)},this.info=function(t){var n;i.timer&&e.cancel(i.timer),n=o("info",t),i.timer=e(function(){n.parentNode&&n.parentNode===document.body&&document.body.removeChild(n),i.timer=null},2e3)},this.progress=function(e){o("progress",e)},this.confirm=function(n,r){var a,s,c;return a=t.defer(),i.timer&&(e.cancel(i.timer),i.timer=null),s=o("warning",n),r&&r.length?r.forEach(function(e){c=document.createElement("button"),c.classList.add("btn","btn-default","btn-sm"),c.innerHTML=e.label,s.appendChild(c,s.childNodes[0]),c.addEventListener("click",function(){document.body.removeChild(s),a.resolve(e.value)})}):(c=document.createElement("button"),c.classList.add("btn","btn-default","btn-sm"),c.innerHTML="是",s.appendChild(c,s.childNodes[0]),c.addEventListener("click",function(){document.body.removeChild(s),a.resolve()}),c=document.createElement("button"),c.classList.add("btn","btn-default","btn-sm"),c.innerHTML="否",s.appendChild(c,s.childNodes[0]),c.addEventListener("click",function(){document.body.removeChild(s),a.reject()})),a.promise}}])},60:function(e,t,n){"use strict";n(44),n(25),n(26),n(27),window.moduleAngularModules=["repos.ui.enroll","tag.ui.enroll","topic.ui.enroll"];var i=n(14);i.oUtilSchema=n(15),i.controller("ctrlTopic",["$scope","http2","tmsLocation",function(e,t,n){e.shareTopic=function(){location.href=n.j("","site","app")+"&topic="+e.topic.id+"&page=share"},e.$watch("app",function(i){if(i){e.setSnsShare(null,{topic:n.s().topic});var o={favor:{}};"Y"===i.can_repos&&(o.repos={}),"Y"===i.can_rank&&(o.rank={}),i.scenarioConfig&&"Y"===i.scenarioConfig.can_action&&(t.get(n.j("notice/count","site","app")).then(function(t){e.noticeCount=t.data}),o.action={}),Object.keys(o).length&&(e.appNavs=o),t.get(n.j("topic/get","site","app","topic")).then(function(t){e.topic=t.data})}})}]),i.controller("ctrlRepos",["$scope","$sce","$q","$uibModal","http2","tmsLocation","$timeout","tmsDynaPage","noticebox",function(e,t,n,i,o,r,a,s,c){function l(e,t){if(t.is_leader){if("S"===t.is_leader)return!0;if("Y"===t.is_leader){if(t.group_id===e.group_id)return!0;if(t.is_editor&&"Y"===t.is_editor)return!0}}return!1}var d,u,p,f,g;g=0,e.page=u={at:1,size:12,total:0},e.filter={},e.criteria=p={rid:"all",creator:!1,favored:!0,agreed:"all",orderby:"lastest"},e.schemas=f={},e.repos=[],e.reposLoading=!1,e.recordList=function(t){var i,a;return a=n.defer(),t?u.at=t:u.at++,1==u.at&&(e.repos=[],u.total=0),i=r.j("repos/recordByTopic","site","app","topic"),i+="&page="+u.at+"&size="+u.size,e.reposLoading=!0,o.post(i,p).then(function(t){u.total=t.data.total,t.data.records&&t.data.records.forEach(function(t){g>t.like_num&&(t._coworkRequireLikeNum=g>t.like_num?g-t.like_num:0),t._canAgree=l(t,e.user),e.repos.push(t)}),s.loadScript(["/static/js/hammer.min.js","/asset/js/xxt.ui.picviewer.js"]),e.reposLoading=!1,a.resolve(t)}),a.promise},e.likeRecord=function(e){var t;t=r.j("record/like","site"),t+="&ek="+e.enroll_key,o.get(t).then(function(t){e.like_log=t.data.like_log,e.like_num=t.data.like_num})},e.remarkRecord=function(e){var t;t=r.j("","site","app"),t+="&ek="+e.enroll_key,t+="&page=cowork#remarks",location.href=t},e.setAgreed=function(e,t){var n;e.agreed!==t&&(n=r.j("record/agree","site"),n+="&ek="+e.enroll_key,n+="&value="+t,o.get(n).then(function(n){e.agreed=t}))},e.favorRecord=function(e){var t;e.favored?c.confirm("取消收藏，确定？").then(function(){t=r.j("favor/remove","site"),t+="&ek="+e.enroll_key,o.get(t).then(function(t){delete e.favored})}):(t=r.j("favor/add","site"),t+="&ek="+e.enroll_key,o.get(t).then(function(t){e.favored=!0,c.info("收藏成功")}))},e.shareRecord=function(e){location.href=r.j("","site","app")+"&ek="+e.enroll_key+"&page=share"},e.editRecord=function(t,n){if(n.userid!==e.user.uid)return void c.warn("不允许编辑其他用户提交的记录");var i;for(var o in e.app.pages){var r=e.app.pages[o];if("I"===r.type){i=r.name;break}}e.gotoPage(t,i,n.enroll_key)},e.shiftAgreed=function(t){p.agreed=t,e.recordList(1)},e.spyRecordsScroll=!0,e.recordsScrollToBottom=function(){e.repos.length<e.page.total&&e.recordList().then(function(){a(function(){e.repos.length<e.page.total&&(e.spyRecordsScroll=!0)})})},e.$watch("app",function(t){t&&(d=t,d.actionRule&&d.actionRule.record&&d.actionRule.record.cowork&&d.actionRule.record.cowork.pre&&d.actionRule.record.cowork.pre.record&&void 0!==d.actionRule.record.cowork.pre.record.likeNum&&(g=parseInt(d.actionRule.record.cowork.pre.record.likeNum)),d.dataSchemas.forEach(function(e){e.shareable&&"Y"===e.shareable&&(f[e.id]=e)}),e.recordList(1))})}])},7:function(e,t,n){t=e.exports=n(0)(!1),t.push([e.i,'.dialog.mask{position:fixed;background:rgba(0,0,0,.3);top:0;left:0;bottom:0;right:0;overflow:auto;z-index:1060}.dialog.dlg{position:absolute;background:#fff;left:0;right:0;bottom:0;margin:15px}.dialog .dlg-body,.dialog .dlg-header{padding:15px 15px 0}.dialog .dlg-footer{text-align:right;padding:15px}.dialog .dlg-footer button{border-radius:0}div[wrap=filter] .detail{background:#ccc}div[wrap=filter] .detail .options .label{display:inline-block;margin:.5em;padding-top:.3em;font-size:100%}div[wrap=filter] .detail .actions .btn{border-radius:0}.tms-act-toggle{position:fixed;right:15px;bottom:8px;width:48px;height:48px;line-height:48px;box-shadow:0 2px 6px rgba(18,27,32,.425);color:#fff;background:#e5b526;border:1px solid #e5b526;border-radius:24px;font-size:20px;text-align:center;cursor:pointer;z-index:1050}.tms-nav-target>*+*{margin-top:.5em}.tms-act-popover-wrap>div+div{margin-top:8px}#frmPlugin{position:absolute;top:0;bottom:0;left:0;right:0;width:100%;height:100%;border:none;z-index:1060;box-sizing:border-box;padding-bottom:48px;background:#fff}#frmPlugin iframe{width:100%;height:100%;border:0}#frmPlugin:after{content:"\\5173\\95ED";position:absolute;width:100px;text-align:center;left:50%;margin-left:-50px;bottom:4px;padding:5px 6px 3px;border:1px solid #ccc;border-radius:4px}div[wrap]>.description{word-wrap:break-word}',""])},8:function(e,t,n){var i=n(7);"string"==typeof i&&(i=[[e.i,i,""]]);var o={hmr:!0};o.transform=void 0,o.insertInto=void 0;n(1)(i,o);i.locals&&(e.exports=i.locals)},9:function(e,t,n){"use strict";window.__util={},window.__util.makeDialog=function(e,t){var n,i;return i=document.createElement("div"),i.setAttribute("id",e),i.classList.add("dialog","mask"),n="<div class='dialog dlg'>",t.header&&t.header.length&&(n+="<div class='dlg-header'>"+t.header+"</div>"),n+="<div class='dlg-body'>"+t.body+"</div>",t.footer&&t.footer.length&&(n+="<div class='dlg-footer'>"+t.footer+"</div>"),n+="</div>",i.innerHTML=n,document.body.appendChild(i),i.children};var i=angular.module("directive.enroll",[]);i.directive("tmsAppNav",["$templateCache",function(e){var t;return t="<div class='tms-nav-target'>",t+="<div ng-if=\"navs.repos\"><button class='btn btn-default btn-block' ng-click=\"goto($event,'repos')\">共享页</button></div>",t+="<div ng-if=\"navs.favor\"><button class='btn btn-default btn-block' ng-click=\"goto($event,'favor')\">收藏页</button></div>",t+="<div ng-if=\"navs.rank\"><button class='btn btn-default btn-block' ng-click=\"goto($event,'rank')\">排行页</button></div>",t+='<div ng-if="navs.action"><button class=\'btn btn-default btn-block\' ng-click="goto($event,\'action\')">动态页<span class=\'notice-count\' ng-if="noticeCount" ng-bind="noticeCount"></span></button></div>',t+="</div>",e.put("appNavTemplate.html",t),{restrict:"A",replace:!0,transclude:!0,scope:{navs:"=appNavs",noticeCount:"=noticeCount"},template:'<span><span ng-if="!navs"><span ng-transclude></span></span><span ng-if="navs" uib-popover-template="\'appNavTemplate.html\'" popover-placement="bottom" popover-trigger="\'outsideClick\'"><span ng-transclude></span><span class=\'notice-count\' ng-if="noticeCount" ng-bind="noticeCount"></span><span class="caret"></span></span></span>',controller:["$scope",function(e){e.goto=function(t,n){e.$parent.gotoPage(t,n)}}]}}]),i.directive("tmsAppAct",["$templateCache",function(e){var t;return t="<div class='tms-act-popover-wrap'>",t+="<div ng-if=\"acts.mockAsMember\"><button class='btn btn-default' ng-click=\"goto($event,'mockAsMember')\"><span ng-if=\"mocker.role!=='member'\">作为</span><span ng-if=\"mocker.role==='member'\">退出</span>成员</button></div>",t+="<div ng-if=\"acts.mockAsVisitor\"><button class='btn btn-default' ng-click=\"goto($event,'mockAsVisitor')\"><span ng-if=\"mocker.role!=='visitor'\">作为</span><span ng-if=\"mocker.role==='visitor'\">退出</span>访客</button></div>",t+="<div ng-if=\"acts.addRecord\"><button class='btn btn-default' ng-click=\"goto($event,'addRecord')\">添加记录</button></div>",t+="<div ng-if=\"acts.save\"><button class='btn btn-default' ng-click=\"goto($event,'save')\">保存</button></div>",t+="</div>",e.put("appActTemplate.html",t),{restrict:"A",replace:!0,scope:{acts:"=appActs"},template:'<button uib-popover-template="\'appActTemplate.html\'" popover-placement="top-right" popover-trigger="\'outsideClick\'" popover-append-to-body="true" class="tms-act-toggle" popover-class="tms-act-popover"><span class=\'glyphicon glyphicon-option-vertical\'></span></button>',controller:["$scope",function(e){e.$watch("acts",function(t){var n;t&&(n=t.mockAsVisitor||t.mockAsMember)&&n.mocker&&angular.isString(n.mocker)&&(e.mocker=e.$parent[n.mocker])&&e.$parent.$watch(n.mocker,function(t){e.mocker=t},!0)}),e.back=function(){history.back()},e.historyLen=function(){return history.length},e.goto=function(t,n){switch(n){case"mockAsVisitor":e.$parent.mockAsVisitor(t,"visitor"!==e.mocker.role);break;case"mockAsMember":e.$parent.mockAsMember(t,"member"!==e.mocker.role);break;case"addRecord":e.$parent.addRecord(t);break;case"save":e.$parent.save();break;default:e.$parent.gotoPage(t,n)}}}]}}]),i.directive("tmsDate",["$compile",function(e){return{restrict:"A",scope:{value:"=tmsDateValue"},controller:["$scope",function(e){e.close=function(){var t;t=document.querySelector("#"+e.dialogID),document.body.removeChild(t),e.opened=!1},e.ok=function(){var t;t=new Date,t.setTime(0),t.setFullYear(e.data.year),t.setMonth(e.data.month-1),t.setDate(e.data.date),t.setHours(e.data.hour),t.setMinutes(e.data.minute),e.value=parseInt(t.getTime()/1e3),e.close()}}],link:function(t,n,i){var o,r,a,s;void 0===t.value&&(t.value=1*new Date/1e3),r=new Date,r.setTime(1e3*t.value),t.options={years:[2014,2015,2016,2017,2018,2019,2020],months:[1,2,3,4,5,6,7,8,9,10,11,12],dates:[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31],hours:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23],minutes:[0,5,10,15,20,25,30,35,40,45,50,55]},a=5*Math.round(r.getMinutes()/5),t.data={year:r.getFullYear(),month:r.getMonth()+1,date:r.getDate(),hour:r.getHours(),minute:a},-1===t.options.minutes.indexOf(a)&&t.options.minutes.push(a),s='<div class="form-group"><select class="form-control" ng-model="data.year" ng-options="y for y in options.years"></select></div>',s+='<div class="form-group"><select class="form-control" ng-model="data.month" ng-options="m for m in options.months"></select></div>',s+='<div class="form-group"><select class="form-control" ng-model="data.date" ng-options="d for d in options.dates"></select></div>',s+='<div class="form-group"><select class="form-control" ng-model="data.hour" ng-options="h for h in options.hours"></select></div>',s+='<div class="form-group"><select class="form-control" ng-model="data.minute" ng-options="mi for mi in options.minutes"></select></div>',o=function(n){if(n.preventDefault(),n.stopPropagation(),!t.opened){var i,o;o="_dlg-"+1*new Date,i={header:"",body:s,footer:'<button class="btn btn-default" ng-click="close()">关闭</button><button class="btn btn-success" ng-click="ok()">确定</button>'},i=__util.makeDialog(o,i),t.opened=!0,t.dialogID=o,e(i)(t)}},n[0].querySelector("[ng-bind]").addEventListener("click",o)}}}]),i.directive("flexImg",function(){return{restrict:"A",replace:!0,template:"<img ng-src='{{img.imgSrc}}'>",link:function(e,t,n){angular.element(t).on("load",function(){var e,t,n=this.clientWidth,i=this.clientHeight;n>i?(e=n/i*80,angular.element(this).css({height:"100%",width:e+"px",top:"0",left:"50%","margin-left":-1*e/2+"px"})):(t=i/n*80,angular.element(this).css({width:"100%",height:t+"px",left:"0",top:"50%","margin-top":-1*t/2+"px"}))})}}}),i.directive("tmsHideParentHeight",function(){return{restrict:"A",link:function(e,t,n){var i,o;if(n.tmsHideParentHeight){i=n.tmsHideParentHeight;for(var r=0,a=t.length;r<a;r++)o=t[r],o.parentElement&&window.addEventListener("resize",function(){o.classList.toggle("hidden",o.parentElement.clientHeight<i)})}}}}),i.directive("tmsScrollSpy",function(){return{restrict:"A",scope:{selector:"@selector",offset:"@",onbottom:"&",toggleSpy:"="},link:function(e,t,n){"window"===e.selector&&window.addEventListener("scroll",function(t){var n;(n=t.target.scrollingElement)&&e.toggleSpy&&e.onbottom&&angular.isFunction(e.onbottom)&&n.clientHeight+n.scrollTop+parseInt(e.offset)>=n.scrollHeight&&e.$apply(function(){e.toggleSpy=!1,e.onbottom()})})}}})}});