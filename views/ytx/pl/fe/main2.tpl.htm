<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <meta content="width=device-width,user-scalable=no,initial-scale=1.0" name="viewport">
        <link href="/static/css/bootstrap.min.css" rel="stylesheet">
        <link href="/static/css/tms.css" rel="stylesheet">
        <link href="/views/default/pl/fe/main.css?_=1" rel="stylesheet">
        <title><?php echo APP_TITLE;?></title>
    </head>
    <body ng-app='app' ng-controller='ctrlMain'>
        <nav class='navbar navbar-default'>
            <div class='container'>
                <div class="navbar-header">
                    <a class='navbar-brand' href='/rest/home' target='_self'><?php echo APP_TITLE;?></a>
                    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target='#navbar-collapse-1'>
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                </div>
                <div class='collapse navbar-collapse' id='navbar-collapse-1'>
                    <form class='navbar-form navbar-right'>
                        <div class="btn-group">
                            <a href='' target='_self' class="btn btn-default"><i class='glyphicon glyphicon-user'></i> {{loginUser.nickname}}</a>
                            <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
                                <span class="caret"></span>
                                <span class="sr-only">Toggle Dropdown</span>
                            </button>
                            <ul class="dropdown-menu" role="menu">
                                <li><a href='/rest/pl/fe/user/settings' target='_self'>用户设置</a></li>
                                <li class="divider"></li>
                                <li><a href='/rest/pl/fe/user/logout' target='_self'>退出</a></li>
                            </ul>
                        </div>
                    </form>
                </div>
            </div>
        </nav>
        <div class='container ng-cloak' ng-cloak>
            <div id='viewRecent' class='row' ng-controller="ctrlRecent">
                <div class='col-md-12'>
                    <nav class='navbar navbar-default tms-panel-heading'>
                        <div class='container-fluid'>
                            <div class="navbar-header">
                                <span class="navbar-brand">我进行的工作</span>
                                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target='#navbar-collapse-2'>
                                    <span class="sr-only">Toggle navigation</span>
                                    <span class="icon-bar"></span>
                                    <span class="icon-bar"></span>
                                    <span class="icon-bar"></span>
                                </button>
                            </div>
                            <div class='collapse navbar-collapse' id='navbar-collapse-2'>
                                <form class='navbar-form navbar-right clearfix'>
                                    <div class='form-group'>
                                        <select class='form-control' ng-model="matterType" ng-change="list(1)">
                                            <option value=''>全部</option>
                                            <option value='mission'>项目</option>
                                            <option value='article'>项目资料</option>
                                            <option value='registration'>报名</option>
                                            <option value='voting'>评价</option>
                                            <option value='signin'>签到</option>
                                            <option value='group'>分组</option>
                                            <option value='enroll'>通用登记</option>
                                            <option value='channel'>频道</option>
                                        </select>
                                    </div>
                                    <button id='popoverAddMatter' uib-popover-template="'addMatter.html'" popover-placement="bottom-right" popover-append-to-body='true' popover-trigger="show" popover-title="新建资料和活动" class='btn btn-default pull-right' ng-click="popoverAddMatter()"><i class='glyphicon glyphicon-plus'></i> <span>新建</span></button>
                                </form>
                            </div>
                        </div>
                    </nav>
                    <div class='tms-panel-body'>
                        <div  class='col-md-4' ng-repeat='m in matters'>
                            <div class='thumbnail matter' ng-class="m.matter_type" ng-click='open(m)'>
                                <h4 class='title' ng-bind="m.matter_title"></h4>
                                <p class='summary' ng-bind="m.matter_summary"></p>
                                <div class='attr'>
                                    <div class='creater_name' ng-bind="m.operator_name"></div>
                                    <div class='create_at' ng-bind="m.operate_at*1000|date:'yyyy-MM-dd'"></div>
                                </div>
                            </div>
                        </div>
                        <div class='col-md-12'>
                            <span style='height:34px;line-height:34px'>总数：{{page.total}}</span>
                            <ul uib-pagination style="margin:0;vertical-align:bottom;cursor:pointer" class='pull-right' ng-show="page.total>page.size" boundary-links="true" total-items="page.total" max-size="7" items-per-page="page.size" rotate="false" ng-model="page.at" previous-text="&lsaquo;" next-text="&rsaquo;" first-text="&laquo;" last-text="&raquo;" ng-change="list()"></ul>
                        </div>
                    </div>
                </div>
            </div>
            <div class='row' ng-controller="ctrlMission">
                <div class='col-md-12'>
                    <nav class='navbar navbar-default tms-panel-heading'>
                        <div class='container-fluid'>
                            <div class="navbar-header">
                                <span class="navbar-brand">我参与的项目</span>
                            </div>
                        </div>
                    </nav>
                    <div class='tms-panel-body'>
                        <div  class='col-md-4' ng-repeat='m in missions'>
                            <div class='thumbnail mission' ng-click='open(m)'>
                                <h4 class='title' ng-bind="m.title"></h4>
                                <p class='summary' ng-bind="m.summary"></p>
                                <div class='attr'>
                                    <div class='creater_name' ng-bind="m.creater_name"></div>
                                    <div class='create_at' ng-bind="m.create_at*1000|date:'yyyy-MM-dd'"></div>
                                </div>
                            </div>
                        </div>
                        <div class='col-md-12'>
                            <span style='height:34px;line-height:34px'>总数：{{page.total}}</span>
                            <ul uib-pagination style="margin:0;vertical-align:bottom;cursor:pointer" class='pull-right' ng-show="page.total>page.size" boundary-links="true" total-items="page.total" max-size="7" items-per-page="page.size" rotate="false" ng-model="page.at" previous-text="&lsaquo;" next-text="&rsaquo;" first-text="&laquo;" last-text="&raquo;" ng-change="list()"></ul>
                        </div>
                    </div>
                </div>
            </div>
            <div class='row'>
                <div class='col-md-12' ng-controller="ctrlSite">
                    <nav class='navbar navbar-default tms-panel-heading'>
                        <div class='container-fluid'>
                            <div class="navbar-header">
                                <span class="navbar-brand">我参与的团队</span>
                            </div>
                            <form class='navbar-form navbar-right'>
                                <button class='btn btn-success' ng-click='create()'><span class='glyphicon glyphicon-plus'></span>新建团队</button>
                            </form>
                        </div>
                    </nav>
                    <div class='tms-panel-body'>
                        <div  class='col-md-4' ng-repeat='site in sites'>
                            <div class='thumbnail site' ng-click="open(site)">
                                <h4 class='title' ng-bind="site.name"></h4>
                                <p class='summary' ng-bind="site.summary"></p>
                                <div class='attr'>
                                    <div class='creater_name' ng-bind="site.creater_name"></div>
                                    <div class='create_at' ng-bind="site.create_at*1000|date:'yyyy-MM-dd'"></div>
                                </div>
                                <div class='actions'>
                                    <a class='btn btn-sm btn-default' ng-click="openHome(site)">主页</a>
                                    <a class='btn btn-sm btn-default' ng-click="openConsole(site)">工作台</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <script type="text/ng-template" id="addMatter.html">
            <div id="addMatter">
                <div class='form-group'>
                    <button class='btn btn-default' ng-click="addMatter('mission')">项目</button>
                </div>
                <div class='form-group'>
                    <button class='btn btn-default' ng-click="addMatter('article')">项目资料</button>
                </div>
                <div class='form-group'>
                    <button class='btn btn-default' ng-click="addMatter('enroll','registration')">在线报名</button>
                    <button class='btn btn-default' ng-click="addMatter('enroll','voting')">评价</button>
                    <button class='btn btn-default' ng-click="addMatter('signin')">签到</button>
                    <button class='btn btn-default' ng-click="addMatter('group')">分组</button>
                    <button class='btn btn-default' ng-click="addMatter('enroll')">通用登记</button>
                </div>
                <div class='form-group'>
                    <button class='btn btn-default' ng-click="addMatter('channel')">频道</button>
                </div>
            <div>
        </script>
        <script type="text/ng-template" id="addMatterSite.html">
            <div class="modal-header">
                <button class="close" type="button" ng-click="cancel()">×</button>
                <h5 class="modal-title ">指定创建素材的团队</h5>
            </div>
            <div class="modal-body ">
                <div class="radio" ng-repeat="site in mySites">
                    <label ng-if="site._favored!=='Y'"><input type='radio' name='site' value="{{$index}}" ng-model='data.index'>{{site.name}}</label>
                </div>
                <div class='alert alert-danger' ng-if="mySites.length===0">请创建添加素材的团队</div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-success" ng-click="ok() ">确定</button>
            </div>
        </script>
        <script src="/static/js/jquery.min.js"></script>
        <script src="/static/js/bootstrap.min.js"></script>
        <script src="/static/js/angular.min.js"></script>
        <script src="/static/js/angular-sanitize.min.js"></script>
        <script src="/static/js/ui-bootstrap-tpls.min.js"></script>
        <script src="/static/js/ui-tms.js"></script>
        <script src="/static/js/xxt.ui.tmplshop.js?_=2"></script>
        <script src="/views/ytx/pl/fe/main2.js"></script>
    </body>
</html>